<h1><b>rsalot</b></h1>
<p>Pada soal diberikan 100 file publikey dan 1 flag.enc
<p>
  <img src="https://github.com/enomarozi/RSA-CTF-Writeup/blob/master/RSA/Image/rsalot.png">
</p>

<h3><b>Solution</b></h3>
<p>Pertama, lakukan ektrak seluruh file publickey untuk memperoleh modulus(n) dan exponent(e). untuk melakukan ekstrak sama dengan pada soal 
<a href="https://github.com/enomarozi/RSA-CTF-Writeup/blob/master/RSA/BackdoorCTF-rsanne.md">rsanne</a> yaitu dengan openssl, tetapi itu sangat lama
karna terdapat 100 file yang harus diekstrak</p>  
<p>Selanjutnya, cari nilai p dengan gcd(faktor persekutuan terbesar) dari semua nilai modulus(n) yang sudah diektrak sebelumnya,
dan cari nilai q, q=n//p</p> 

```python
import math
from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_OAEP

#ekstrak 100 file publikey
pubkeys = []
for i in range(100):
    with open('%d.pem' % (i+1)) as fh:
        key = RSA.importKey(fh.read())
    pubkeys.append(key)

#generate p dari semua gcd modulus n
keys = {}
for j, b in enumerate(pubkeys):
    for i, a in enumerate(pubkeys[: j]):
        p = math.gcd(a.n, b.n)
        if p != 1:
            for k in [ i, j ]:
                n = pubkeys[k].n
                print("n : ",n)
                print("p : ",p)
                print("q : ",n//p)
```
<p>maka didapatkan 2 kemungkinan (n,p,q), untuk decrypt file</p>
<pre>
n1 :  23260716557375690457724340517814798553284093383675955753210132374509973258283306822538580132700875733321460692101694179361245119306418651193402512612500111442624876103473535129327037097046343634997541541496318494961543987552228754832236044259856000320983983126129412431801144031562287397570846392952905862981221569085591696654562289384531854207702626277469166158114197478525681143466552721501485707709954322005798540444098755630199517759570465455471064172816576843800829708415595842816666071002921806841594943525213770657127124965423586840200929234600612382079511164305586033156711399178225762365306090386434107266037
p1 :  168736462866079204789584058199620418225526506348478399447895958829038354002285480486576728303147995561507709511105490546002439968559726489519296139857978907240880718150991015966920369123795034196767754935707681686046233424449917085120027639055362329862072939086970892956139024391556483288415208981014264336691
q1 :  137852341825115687630372545540234125575043643297743715914372468140743017665122928684176567678186288631724569119078697598260381091322877334920545216266418987980787824645288016924652387350842372904949656504253960440751217710040954075691996893620788950284865727480192510130305432030965910622333944701850333681207
n2 :  23489536169894875104380319731091524594886928982079989680685140526506816078328377365920912691345973867274127369888617266471562817001630072737234558761977577075038991165371860879920389022518216143091522409148685349425962144785062882226489262290433631048454159440985148197906498710065684391869085391454754106309032049154232850533299594084654876542951785594662744724164946205787746362648504615426049549895862885960678401490612936954071297209796703651121038358809482596283354654704634698014090659491829169711549185505494879482606511678080905510586288124335730218605304747220982982161819303534160762335592895244302851836981
p2 :  168736462866079204789584058199620418225526506348478399447895958829038354002285480486576728303147995561507709511105490546002439968559726489519296139857978907240880718150991015966920369123795034196767754935707681686046233424449917085120027639055362329862072939086970892956139024391556483288415208981014264336691
q2 :  139208418683860744636489594107518498051692876942105482068436575406002091300025595750940476658875774324613311765708231971440632450100860632595797604226237831396754383891914573698131769762436941837224713009721577421233571830899874638297795728204831707647487557389464078420524002550428515370686466308350190419191
</pre>
<p>Terakhir, Decrypt file flag.enc</p>

```python
import base64
import gmpy2
from Crypto.PublicKey import RSA
from Crypto.Cipher import PKCS1_OAEP
n = 23489536169894875104380319731091524594886928982079989680685140526506816078328377365920912691345973867274127369888617266471562817001630072737234558761977577075038991165371860879920389022518216143091522409148685349425962144785062882226489262290433631048454159440985148197906498710065684391869085391454754106309032049154232850533299594084654876542951785594662744724164946205787746362648504615426049549895862885960678401490612936954071297209796703651121038358809482596283354654704634698014090659491829169711549185505494879482606511678080905510586288124335730218605304747220982982161819303534160762335592895244302851836981
p = 168736462866079204789584058199620418225526506348478399447895958829038354002285480486576728303147995561507709511105490546002439968559726489519296139857978907240880718150991015966920369123795034196767754935707681686046233424449917085120027639055362329862072939086970892956139024391556483288415208981014264336691
q = 139208418683860744636489594107518498051692876942105482068436575406002091300025595750940476658875774324613311765708231971440632450100860632595797604226237831396754383891914573698131769762436941837224713009721577421233571830899874638297795728204831707647487557389464078420524002550428515370686466308350190419191
e = 65537
d = lambda p, q, e: int(gmpy2.invert(e, (p-1)*(q-1)))

key = RSA.construct((p*q, e, d(p, q, e)))
key = PKCS1_OAEP.new(key)
with open('flag.enc') as fh:
    c = base64.b64decode(fh.read())
print(key.decrypt(c).decode())
```

<h3><b>Flag</b></h3>
<pre>
 the_flag_is_b767b9d1fe02eb1825de32c6dacf4c2ef78c738ab0c498013347f4ea1e95e8fa
</pre>

